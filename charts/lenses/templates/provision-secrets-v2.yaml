{{- if and .Values.lenses.provision.enabled (eq .Values.lenses.provision.version "2")}}
kind: Secret
apiVersion: v1
metadata:
  name: {{include "provisionFullname" .}}
  labels:
    app: {{include "fullname" .}}
    chart: {{printf "%s-%s" .Chart.Name .Chart.Version}}
    release: {{.Release.Name}}
    heritage: {{.Release.Service}}
    lenses.io/app: {{include "fullname" .}}
    lenses.io/app.type: lenses-provision-secret
data:
  license.json: {{ toJson (required "license.json is required to provision Lenses" .Values.lenses.provision.license) | b64enc }}
  provisioning.yaml: {{ toYaml (required "provisioning connections is required to provision Lenses" .Values.lenses.provision.connections) | b64enc }}
stringData:
  license.json: |-
    {{- toJson (required "license.json is required to provision Lenses" .Values.lenses.provision.license) | nindent 4}}
  provisioning.yaml: |-
    {{- toYaml (required "provisioning connections is required to provision Lenses" .Values.lenses.provision.connections) | nindent 4}}
{{- end}}